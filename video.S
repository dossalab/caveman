

// This is autogenerated file - DO NOT EDIT

#include <avr/interrupt.h>
#include <avr/io.h>

#include "video-internal.h"

.extern video_line_counter
.extern video_buffer

#define NORMAL_SCANLINES 2

// Start of the scanline interrupt
.global TIMER2_COMP_vect
TIMER2_COMP_vect:
    // First check where the sync pulse bit is.
    // If it's the first occurence of this interrupt (sync bit is asserted), just reset it back and return
    // This part does not modify SREG or registers, so we're good

    sbic _SFR_IO_ADDR(VIDEO_PORT), VIDEO_SYNC_BIT
    rjmp start_scanline

    // Sync bit asserted (we're outputting a sync pulse) -> deassert
    sbi _SFR_IO_ADDR(VIDEO_PORT), VIDEO_SYNC_BIT
    reti

    // Sync bit is not asserted
    // So we know we completed the sync pulse and back porch. We can start drawing now
start_scanline:
    push r16

    // Stop the timer, as we're gonna block the execution for the next ~52 us
    ldi r16, VIDEO_TIMER_VALUE_STOP
    out _SFR_IO_ADDR(TCCR2), r16

    in r16, _SFR_IO_ADDR(SREG)
    push r16
    push r30
    push r31

    // We can check the video line counter first
    lds r16, video_line_counter
    inc r16
    sts video_line_counter, r16

    // And if it is less than NORMAL_SCANLINES, draw normal scanlines
    // XXX: These conditionals and jumps delay us a bit.
    // It would make more sense to draw normal scanlines here.
    // But brlo cannot jump more than ~63 words, so our unwinded loop here bites us in the ass
    ldi r30, NORMAL_SCANLINES
    cp r16, r30
    brlo do_normal_scanline

do_blanking_scanline:
    ldi r16, 210
blanking_scanline_loop:
    dec r16
    brne blanking_scanline_loop

finish_scanline:
    // End of video, front porch starts here. We don't need Z and SREG anymore
    pop r31
    pop r30
    pop r16
    out _SFR_IO_ADDR(SREG), r16

    // End of front porch
    cbi _SFR_IO_ADDR(VIDEO_PORT), VIDEO_SYNC_BIT

    // Prepare to start a next line, so run a timer again
    ldi r16, VIDEO_TIMER_VALUE_START
    out _SFR_IO_ADDR(TCCR2), r16

    pop r16
    reti

do_normal_scanline:
    ldi r30, lo8(video_buffer)
    ldi r31, hi8(video_buffer)

    // We use that sort of loop unwinding here to make it extra fast, each of these takes 3 cycles
    ld r16, Z+      ; data[0]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[0]
    ld r16, Z+      ; data[1]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[1]
    ld r16, Z+      ; data[2]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[2]
    ld r16, Z+      ; data[3]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[3]
    ld r16, Z+      ; data[4]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[4]
    ld r16, Z+      ; data[5]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[5]
    ld r16, Z+      ; data[6]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[6]
    ld r16, Z+      ; data[7]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[7]
    ld r16, Z+      ; data[8]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[8]
    ld r16, Z+      ; data[9]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[9]
    ld r16, Z+      ; data[10]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[10]
    ld r16, Z+      ; data[11]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[11]
    ld r16, Z+      ; data[12]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[12]
    ld r16, Z+      ; data[13]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[13]
    ld r16, Z+      ; data[14]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[14]
    ld r16, Z+      ; data[15]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[15]
    ld r16, Z+      ; data[16]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[16]
    ld r16, Z+      ; data[17]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[17]
    ld r16, Z+      ; data[18]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[18]
    ld r16, Z+      ; data[19]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[19]
    ld r16, Z+      ; data[20]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[20]
    ld r16, Z+      ; data[21]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[21]
    ld r16, Z+      ; data[22]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[22]
    ld r16, Z+      ; data[23]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[23]
    ld r16, Z+      ; data[24]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[24]
    ld r16, Z+      ; data[25]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[25]
    ld r16, Z+      ; data[26]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[26]
    ld r16, Z+      ; data[27]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[27]
    ld r16, Z+      ; data[28]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[28]
    ld r16, Z+      ; data[29]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[29]
    ld r16, Z+      ; data[30]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[30]
    ld r16, Z+      ; data[31]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[31]
    ld r16, Z+      ; data[32]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[32]
    ld r16, Z+      ; data[33]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[33]
    ld r16, Z+      ; data[34]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[34]
    ld r16, Z+      ; data[35]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[35]
    ld r16, Z+      ; data[36]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[36]
    ld r16, Z+      ; data[37]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[37]
    ld r16, Z+      ; data[38]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[38]
    ld r16, Z+      ; data[39]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[39]
    ld r16, Z+      ; data[40]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[40]
    ld r16, Z+      ; data[41]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[41]
    ld r16, Z+      ; data[42]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[42]
    ld r16, Z+      ; data[43]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[43]
    ld r16, Z+      ; data[44]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[44]
    ld r16, Z+      ; data[45]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[45]
    ld r16, Z+      ; data[46]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[46]
    ld r16, Z+      ; data[47]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[47]
    ld r16, Z+      ; data[48]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[48]
    ld r16, Z+      ; data[49]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[49]
    ld r16, Z+      ; data[50]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[50]
    ld r16, Z+      ; data[51]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[51]
    ld r16, Z+      ; data[52]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[52]
    ld r16, Z+      ; data[53]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[53]
    ld r16, Z+      ; data[54]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[54]
    ld r16, Z+      ; data[55]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[55]
    ld r16, Z+      ; data[56]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[56]
    ld r16, Z+      ; data[57]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[57]
    ld r16, Z+      ; data[58]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[58]
    ld r16, Z+      ; data[59]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[59]
    ld r16, Z+      ; data[60]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[60]
    ld r16, Z+      ; data[61]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[61]
    ld r16, Z+      ; data[62]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[62]
    ld r16, Z+      ; data[63]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[63]
    ld r16, Z+      ; data[64]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[64]
    ld r16, Z+      ; data[65]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[65]
    ld r16, Z+      ; data[66]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[66]
    ld r16, Z+      ; data[67]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[67]
    ld r16, Z+      ; data[68]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[68]
    ld r16, Z+      ; data[69]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[69]
    ld r16, Z+      ; data[70]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[70]
    ld r16, Z+      ; data[71]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[71]
    ld r16, Z+      ; data[72]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[72]
    ld r16, Z+      ; data[73]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[73]
    ld r16, Z+      ; data[74]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[74]
    ld r16, Z+      ; data[75]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[75]
    ld r16, Z+      ; data[76]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[76]
    ld r16, Z+      ; data[77]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[77]
    ld r16, Z+      ; data[78]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[78]
    ld r16, Z+      ; data[79]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[79]
    ld r16, Z+      ; data[80]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[80]
    ld r16, Z+      ; data[81]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[81]
    ld r16, Z+      ; data[82]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[82]
    ld r16, Z+      ; data[83]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[83]
    ld r16, Z+      ; data[84]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[84]
    ld r16, Z+      ; data[85]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[85]
    ld r16, Z+      ; data[86]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[86]
    ld r16, Z+      ; data[87]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[87]
    ld r16, Z+      ; data[88]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[88]
    ld r16, Z+      ; data[89]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[89]
    ld r16, Z+      ; data[90]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[90]
    ld r16, Z+      ; data[91]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[91]
    ld r16, Z+      ; data[92]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[92]
    ld r16, Z+      ; data[93]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[93]
    ld r16, Z+      ; data[94]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[94]
    ld r16, Z+      ; data[95]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[95]
    ld r16, Z+      ; data[96]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[96]
    ld r16, Z+      ; data[97]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[97]
    ld r16, Z+      ; data[98]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[98]
    ld r16, Z+      ; data[99]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[99]
    ld r16, Z+      ; data[100]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[100]
    ld r16, Z+      ; data[101]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[101]
    ld r16, Z+      ; data[102]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[102]
    ld r16, Z+      ; data[103]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[103]
    ld r16, Z+      ; data[104]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[104]
    ld r16, Z+      ; data[105]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[105]
    ld r16, Z+      ; data[106]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[106]
    ld r16, Z+      ; data[107]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[107]
    ld r16, Z+      ; data[108]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[108]
    ld r16, Z+      ; data[109]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[109]
    ld r16, Z+      ; data[110]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[110]
    ld r16, Z+      ; data[111]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[111]
    ld r16, Z+      ; data[112]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[112]
    ld r16, Z+      ; data[113]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[113]
    ld r16, Z+      ; data[114]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[114]
    ld r16, Z+      ; data[115]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[115]
    ld r16, Z+      ; data[116]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[116]
    ld r16, Z+      ; data[117]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[117]
    ld r16, Z+      ; data[118]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[118]
    ld r16, Z+      ; data[119]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[119]
    ld r16, Z+      ; data[120]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[120]
    ld r16, Z+      ; data[121]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[121]
    ld r16, Z+      ; data[122]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[122]
    ld r16, Z+      ; data[123]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[123]
    ld r16, Z+      ; data[124]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[124]
    ld r16, Z+      ; data[125]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[125]
    ld r16, Z+      ; data[126]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[126]
    ld r16, Z+      ; data[127]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[127]
    ld r16, Z+      ; data[128]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[128]
    ld r16, Z+      ; data[129]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[129]
    ld r16, Z+      ; data[130]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[130]
    ld r16, Z+      ; data[131]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[131]
    ld r16, Z+      ; data[132]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[132]
    ld r16, Z+      ; data[133]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[133]
    ld r16, Z+      ; data[134]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[134]
    ld r16, Z+      ; data[135]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[135]
    ld r16, Z+      ; data[136]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[136]
    ld r16, Z+      ; data[137]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[137]
    ld r16, Z+      ; data[138]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[138]
    ld r16, Z+      ; data[139]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[139]
    ld r16, Z+      ; data[140]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[140]
    ld r16, Z+      ; data[141]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[141]
    ld r16, Z+      ; data[142]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[142]
    ld r16, Z+      ; data[143]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[143]
    ld r16, Z+      ; data[144]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[144]
    ld r16, Z+      ; data[145]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[145]
    ld r16, Z+      ; data[146]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[146]
    ld r16, Z+      ; data[147]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[147]
    ld r16, Z+      ; data[148]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[148]
    ld r16, Z+      ; data[149]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[149]
    ld r16, Z+      ; data[150]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[150]
    ld r16, Z+      ; data[151]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[151]
    ld r16, Z+      ; data[152]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[152]
    ld r16, Z+      ; data[153]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[153]
    ld r16, Z+      ; data[154]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[154]
    ld r16, Z+      ; data[155]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[155]
    ld r16, Z+      ; data[156]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[156]
    ld r16, Z+      ; data[157]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[157]
    ld r16, Z+      ; data[158]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[158]
    ld r16, Z+      ; data[159]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[159]
    ld r16, Z+      ; data[160]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[160]
    ld r16, Z+      ; data[161]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[161]
    ld r16, Z+      ; data[162]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[162]
    ld r16, Z+      ; data[163]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[163]
    ld r16, Z+      ; data[164]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[164]
    ld r16, Z+      ; data[165]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[165]
    ld r16, Z+      ; data[166]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[166]
    ld r16, Z+      ; data[167]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[167]
    ld r16, Z+      ; data[168]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[168]
    ld r16, Z+      ; data[169]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[169]
    ld r16, Z+      ; data[170]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[170]
    ld r16, Z+      ; data[171]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[171]
    ld r16, Z+      ; data[172]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[172]
    ld r16, Z+      ; data[173]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[173]
    ld r16, Z+      ; data[174]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[174]
    ld r16, Z+      ; data[175]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[175]
    ld r16, Z+      ; data[176]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[176]
    ld r16, Z+      ; data[177]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[177]
    ld r16, Z+      ; data[178]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[178]
    ld r16, Z+      ; data[179]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[179]
    ld r16, Z+      ; data[180]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[180]
    ld r16, Z+      ; data[181]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[181]
    ld r16, Z+      ; data[182]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[182]
    ld r16, Z+      ; data[183]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[183]
    ld r16, Z+      ; data[184]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[184]
    ld r16, Z+      ; data[185]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[185]
    ld r16, Z+      ; data[186]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[186]
    ld r16, Z+      ; data[187]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[187]
    ld r16, Z+      ; data[188]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[188]
    ld r16, Z+      ; data[189]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[189]
    ld r16, Z+      ; data[190]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[190]
    ld r16, Z+      ; data[191]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[191]
    ld r16, Z+      ; data[192]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[192]
    ld r16, Z+      ; data[193]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[193]
    ld r16, Z+      ; data[194]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[194]
    ld r16, Z+      ; data[195]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[195]
    ld r16, Z+      ; data[196]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[196]
    ld r16, Z+      ; data[197]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[197]
    ld r16, Z+      ; data[198]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[198]
    ld r16, Z+      ; data[199]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[199]
    ld r16, Z+      ; data[200]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[200]
    ld r16, Z+      ; data[201]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[201]
    ld r16, Z+      ; data[202]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[202]
    ld r16, Z+      ; data[203]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[203]
    ld r16, Z+      ; data[204]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[204]
    ld r16, Z+      ; data[205]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[205]
    ld r16, Z+      ; data[206]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[206]
    ld r16, Z+      ; data[207]
    out _SFR_IO_ADDR(PORTD), r16    ; PORTD = data[207]

    // XXX: Make sure video bit is cleared
    cbi _SFR_IO_ADDR(PORTD), 7

    rjmp finish_scanline